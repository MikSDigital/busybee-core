#PersonBundle
parameters:
    staffPagination:
        alias: s
        sortBy:
            Family Name: 
                p.surname: ASC
                p.firstName: ASC
            Given Name: 
                p.firstName: ASC
                p.surname: ASC
            Email: 
                p.email: ASC
                p.surname: ASC
                p.firstName: ASC
        limit: '10'
        searchList:
            - p.surname
            - p.firstName
            - p.email
        join:
            s.person:
                alias: p
                type: leftJoin
        select:
            - p.surname
            - p.firstName
            - s.id
            - p.email
    personPagination:
        alias: p
        sortBy:
            Family Name: 
                p.surname: ASC
                p.firstName: ASC
            Given Name: 
                p.firstName: ASC
                p.surname: ASC
            Email: 
                p.email: ASC
                p.surname: ASC
                p.firstName: ASC
        limit: '10'
        searchList:
            - p.surname
            - p.firstName
            - p.email
    studentPagination:
        alias: s
        sortBy:
            Family Name:
                p.surname: ASC
                p.firstName: ASC
            Given Name:
                p.firstName: ASC
                p.surname: ASC
            Email:
                p.email: ASC
                p.surname: ASC
                p.firstName: ASC
        limit: '10'
        searchList:
            - p.surname
            - p.firstName
            - p.email
        join:
            s.person:
                alias: p
                type: leftJoin
        select:
            - p.surname
            - p.firstName
            - s.id
            - p.email
services:
    person.repository:
        class: Busybee\PersonBundle\Repository\PersonRepository
        factory: 
            - "@doctrine"
            - 'getRepository' 
        arguments: 
            - "BusybeePersonBundle:Person"
    person.pagination:
        class: Busybee\PersonBundle\Model\PersonPagination
        arguments: 
            - '%personPagination%'
            - '@person.repository'
            - '@my_service_container'
    staff.repository:
        class: Busybee\PersonBundle\Repository\StaffRepository
        factory: 
            - "@doctrine"
            - 'getRepository' 
        arguments: 
            - "BusybeePersonBundle:Staff"
    student.repository:
        class: Busybee\PersonBundle\Repository\StudentRepository
        factory:
            - "@doctrine"
            - 'getRepository'
        arguments:
            - "BusybeePersonBundle:Student"
    address.manager:
        class: Busybee\PersonBundle\Model\AddressManager
        arguments:
            - '@translator'
            - '@setting.manager'
            - '@address.repository'
    locality.repository:
        class: Busybee\PersonBundle\Repository\LocalityRepository
        factory: 
            - "@doctrine"
            - 'getRepository' 
        arguments: 
            - "BusybeePersonBundle:Locality"
    address.repository:
        class: Busybee\PersonBundle\Repository\AddressRepository
        factory: 
            - "@doctrine"
            - 'getRepository' 
        arguments: 
            - "BusybeePersonBundle:Address"
    phone.repository:
        class: Busybee\PersonBundle\Repository\PhoneRepository
        factory: 
            - "@doctrine"
            - 'getRepository' 
        arguments: 
            - "BusybeePersonBundle:Phone"
    person.uploader.photo:
        class: Busybee\PersonBundle\Model\PhotoUploader
        arguments:
            - "%upload_path%"
    person.listener:
        class: Busybee\PersonBundle\EventListener\PersonListener
        arguments: ['@person.uploader.photo']
        tags:
            - { name: doctrine.event_listener, event: prePersist }
            - { name: doctrine.event_listener, event: preUpdate }
            - { name: doctrine.event_listener, event: postLoad }
            - { name: doctrine.event_listener, event: postUpdate }
            - { name: doctrine.event_listener, event: postRemove }
    person.form.personType:
        class: Busybee\PersonBundle\Form\PersonType
        arguments:
            - '@setting.manager'
            - '@doctrine.orm.entity_manager'
            - '@person.uploader.photo'
        tags: 
            - { name: form.type }
    person.form.addressType:
        class: Busybee\PersonBundle\Form\AddressType
        arguments:
            - '@setting.manager'
            - '@doctrine.orm.entity_manager'
        tags: 
            - { name: form.type }
    person.form.localityType:
        class: Busybee\PersonBundle\Form\LocalityType
        arguments:
            - '@setting.manager'
            - '@locality.repository'
        tags: 
            - { name: form.type }
    person.form.type.phone:
        class: Busybee\PersonBundle\Form\PhoneType
        arguments:
            - '@setting.manager'
            - '@phone.repository'
        tags: 
            - { name: form.type }    
    person.phone.validator:
        class: Busybee\PersonBundle\Validator\Constraints\PhoneValidator
        arguments:
            - '@setting.manager'
        tags:
            - { name: validator.constraint_validator, alias: phone_validator }
    person.manager:
        class: Busybee\PersonBundle\Model\PersonManager
        arguments:
            - '@setting.manager'
            - '@doctrine.orm.entity_manager'
    person.image.validator:
        class: Busybee\PersonBundle\Validator\Constraints\PersonImageValidator
        tags:
            - { name: validator.constraint_validator, alias: person_image_validator }
    form.select.locality.type:
        class: Busybee\PersonBundle\Form\SelectLocalityType
        arguments:
            - '@locality.repository'
        tags:
            - { name: form.type }
    student.pagination:
        class: Busybee\PersonBundle\Model\StudentPagination
        arguments:
            - '%studentPagination%'
            - '@student.repository'
            - '@my_service_container'
    person.extension:
        class: Busybee\PersonBundle\Model\PersonExtension
        arguments:
            - '@setting.manager'
            - '@person.manager'
        tags:
            - { name: twig.extension }
    caregiver.repository:
        class: Busybee\PersonBundle\Repository\CareGiverRepository
        factory:
            - "@doctrine"
            - 'getRepository'
        arguments:
            - "BusybeePersonBundle:CareGiver"
