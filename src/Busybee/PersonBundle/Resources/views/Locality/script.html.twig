{# src/Busybee/PersonBundle/Resources/views/Locality/script.html.twig #}

{% trans_default_domain "BusybeePersonBundle" %}

	<script>
		$('.beeLocalityList{{ classSuffix }}').change(function() {
		  	$.ajax({
				url: '{{ path('locality_fetch') }}',	
				data: {'id': $(this).val()},
				type: 'POST',
				success: function(data) {
					$('.beeLocality{{ classSuffix }}').val(data.locality);
					$('.beeTerritory{{ classSuffix }}').val(data.territory);
					$('.beeCountry{{ classSuffix }}').val(data.country);
					$('.beePostCode{{ classSuffix }}').val(data.postCode);
					$('.beeAddressList{{ classSuffix }}').autocomplete( "option", "source", data.addressList );
					if (data.addressDisabled == 'true') {
						$('.beeAddressList{{ classSuffix }}').autocomplete( 'disable' );
						$('.beeAddressList{{ classSuffix }}').prop('disabled', true);
					} else {
						$('.beeAddressList{{ classSuffix }}').prop('disabled', false);
						$('.beeAddressList{{ classSuffix }}').autocomplete( 'enable' );
					}
					$('.beeAddressList{{ classSuffix }}').data('ui-autocomplete')._trigger('select', 'autocompleteselect', {item:{label: '', value: 0}});
				}
			});
		});
		$('.beeLocalitySave{{ classSuffix }}').click(function() {
			$.ajax({
				url: '{{ path('locality_edit') }}',	
				data: {
					'id': $('.beeLocalityList{{ classSuffix }}').val(),
					'locality': $('.beeLocality{{ classSuffix }}').val(),
					'territory': $('.beeTerritory{{ classSuffix }}').val(),
					'country': $('.beeCountry{{ classSuffix }}').val(),
					'postCode': $('.beePostCode{{ classSuffix }}').val()
				},
				type: 'POST',
				success: function(data) {
					$('.beeLocality{{ classSuffix }}').val(data.locality);
					$('.beeTerritory{{ classSuffix }}').val(data.territory);
					$('.beeCountry{{ classSuffix }}').val(data.country);
					$('.beePostCode{{ classSuffix }}').val(data.postCode);
					$(".beeLocalityList{{ classSuffix }}").html(data.options);
					$(".beeLocalityList{{ classSuffix }}").val(data.id);
					$('#localityMessage{{ classSuffix }}').show()
					$('#localityMessage{{ classSuffix }}').removeClass().addClass('row alert alert-' + data.status);
					$('#localityMessage{{ classSuffix }}').html(data.message);
					$('#localityMessage{{ classSuffix }}').fadeOut(3000);
				}
			});
		});
	</script>
