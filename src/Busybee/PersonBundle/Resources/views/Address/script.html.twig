{# src/Busybee/PersonBundle/Resources/views/Address/script.html.twig #}

{% trans_default_domain "BusybeePersonBundle" %}

{% if classSuffix is not defined %}{% set classSuffix = '' %}{% endif %}

	<script>
		$('.beeAddressList{{ classSuffix }}').change(function() {
			$.ajax({
				url: '{{ path('address_fetch') }}',	
				data: {'id': $(this).val()},
				type: 'POST',
				success: function(data) {
					$('.beeLine1{{ classSuffix }}').val(data.line1);
					$('.beeTerritory{{ classSuffix }}').val(data.line2);
					$('.beeLocalityList{{ classSuffix }}').val(data.locality);
					$(".beeLocalityList{{ classSuffix }}").trigger('change');
				}
			});
		});
		$('.beeAddressSave{{ classSuffix }}').click(function() {
			$.ajax({
				url: '{{ path('address_edit') }}',	
				data: {
					'id': $('.beeAddressList{{ classSuffix }}').val(),
					'line1': $('.beeLine1{{ classSuffix }}').val(),
					'line2': $('.beeLine2{{ classSuffix }}').val(),
					'locality_id': $('.beeLocalityList{{ classSuffix }}').val()
				},
				type: 'POST',
				success: function(data) {
					$('.beeLocalityList{{ classSuffix }}').val(data.locality);
					$('.beeLine1{{ classSuffix }}').val(data.line1);
					$('.beeLine2{{ classSuffix }}').val(data.line2);
					$(".beeAddressList{{ classSuffix }}").html(data.options);
					$(".beeAddressList{{ classSuffix }}").val(data.id);
					$('#addressMessage{{ classSuffix }}').show()
					$('#addressMessage{{ classSuffix }}').removeClass().addClass('row alert alert-' + data.status);
					$('#addressMessage{{ classSuffix }}').html(data.message);
					$('#addressMessage{{ classSuffix }}').fadeOut(3000);
					$(".beeLocalityList{{ classSuffix }}").trigger('change');
				}
			});
		});
	</script>
