{# src/Busybee/PersonBundle/Resources/views/Address/script.html.twig #}

{% trans_default_domain "BusybeePersonBundle" %}

{% set altSuffix = 'address2' %}
{% if classSuffix == 'address2' %}{% set altSuffix = 'address1' %}{% endif %}

	<script>
		$( '.beeAddressList{{ classSuffix }}' ).on( "autocompleteselect", function( event, ui ) {
			if (! ui.item.stopFetch) {
				$.ajax({
					url: '{{ path('address_fetch') }}',	
					data: {'id': ui.item.value},
					type: 'POST',
					success: function(data) {
						$('.beePropertyName{{ classSuffix }}').val(data.propertyName);
						$('.beeStreetName{{ classSuffix }}').val(data.streetName);
						$('.beeStreetNumber{{ classSuffix }}').val(data.streetNumber);
						$('.beeBuildingType{{ classSuffix }}').val(data.buildingType);
						$('.beeBuildingNumber{{ classSuffix }}').val(data.buildingNumber);
						$('.beeAddressValue{{ classSuffix }}').val(data.id);
						$('.beeAddressList{{ classSuffix }}').val(data.addressListLabel);
						$('#addressDisplay{{ classSuffix }}').html(data.address);
						if (data.id > 0)
						{
							$('.beeAddressList{{ classSuffix }}').autocomplete( "option", "disabled", true );
							$('.beeAddressList{{ classSuffix }}').autocomplete( 'disable' );
							$('.beeAddressList{{ classSuffix }}').prop('disabled', true);
						}
					}
				});
			}
		});
		
		$('.beeAddressSave{{ classSuffix }}').click(function() {
			$.ajax({
				url: '{{ path('address_edit') }}',	
				data: {
					'id': $('.beeAddressValue{{ classSuffix }}').val(),
                    '_token': '{{ form._token.vars.value }}',
					'propertyName': $('.beePropertyName{{ classSuffix }}').val(),
					'streetName': $('.beeStreetName{{ classSuffix }}').val(),
					'streetNumber': $('.beeStreetNumber{{ classSuffix }}').val(),
					'buildingType': $('.beeBuildingType{{ classSuffix }}').val(),
					'buildingNumber': $('.beeBuildingNumber{{ classSuffix }}').val(),
					'locality_id': $('.beeLocalityList{{ classSuffix }}').val()
				},
				type: 'POST',
				success: function(data) {
					$('.beePropertyName{{ classSuffix }}').val(data.propertyName);
					$('.beeStreetName{{ classSuffix }}').val(data.streetName);
					$('.beeStreetNumber{{ classSuffix }}').val(data.streetNumber),
					$('.beeBuildingType{{ classSuffix }}').val(data.buildingType),
					$('.beeBuildingNumber{{ classSuffix }}').val(data.buildingNumber),
					$('#addressDisplay{{ classSuffix }}').html(data.address);
					$('.beeAddressList{{ classSuffix }}').autocomplete( "option", "source", data.addressList );
					$('.beeAddressList{{ classSuffix }}').data('ui-autocomplete')._trigger('select', 'autocompleteselect', {item:{label: data.addressListLabel, value: data.id}});
					if (data.addressDisabled == 'true') {
						$('.beeAddressList{{ classSuffix }}').autocomplete( "option", "disabled", true );
						$('.beeAddressList{{ classSuffix }}').autocomplete( 'disable' );
						$('.beeAddressList{{ classSuffix }}').prop('disabled', true);
					} else {
						$('.beeAddressList{{ classSuffix }}').autocomplete( "option", "disabled", false );
						$('.beeAddressList{{ classSuffix }}').prop('disabled', false);
						$('.beeAddressList{{ classSuffix }}').autocomplete( 'enable' );
					}
					$('#addressMessage{{ classSuffix }}').show()
					$('#addressMessage{{ classSuffix }}').removeClass().addClass('row alert alert-' + data.status);
					$('#addressMessage{{ classSuffix }}').html(data.message);
					$('#addressMessage{{ classSuffix }}').fadeOut(3000);
				}
			});
		});
		$('.beeAddressClear{{ classSuffix }}').click(function() {
			$('.beePropertyName{{ classSuffix }}').val('');
			$('.beeStreetName{{ classSuffix }}').val('');
			$('.beeStreetNumber{{ classSuffix }}').val('');
			$('.beeBuildingType{{ classSuffix }}').val('');
			$('.beeBuildingNumber{{ classSuffix }}').val('');
			$('.beeLocality{{ classSuffix }}').val('');
			$('.beeTerritory{{ classSuffix }}').val('');
			$('.beeCountry{{ classSuffix }}').val('');
			$('.beePostCode{{ classSuffix }}').val('');
			$('.beeLocalityList{{ classSuffix }}').val('');
			$('.beeAddressValue{{ classSuffix }}').val('');
			$('.beeAddressList{{ classSuffix }}').val('');
			$('#addressDisplay{{ classSuffix }}').html("<pre> </pre>");
			$('.beeAddressList{{ classSuffix }}').autocomplete( "option", "disabled", true );
			$('.beeAddressList{{ classSuffix }}').autocomplete( 'disable' );
			$('.beeAddressList{{ classSuffix }}').prop('disabled', true);
		});
	</script>
