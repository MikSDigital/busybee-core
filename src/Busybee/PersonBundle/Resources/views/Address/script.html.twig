{# src/Busybee/PersonBundle/Resources/views/Address/script.html.twig #}

{% trans_default_domain "BusybeePersonBundle" %}

	<script>
		$( '.beeAddressList' ).on( "autocompleteselect", function( event, ui ) {
			if (! ui.item.stopFetch) {
				$.ajax({
					url: '{{ path('address_fetch') }}',	
					data: {'id': ui.item.value},
					type: 'POST',
					success: function(data) {
						$('.beePropertyName').val(data.propertyName);
						$('.beeStreetName').val(data.streetName);
						$('.beeStreetNumber').val(data.streetNumber);
						$('.beeBuildingType').val(data.buildingType);
						$('.beeBuildingNumber').val(data.buildingNumber);
						$('.beeAddressValue').val(data.id);
						$('.beeAddressList').val(data.addressListLabel);
						$('#addressDisplay').html(data.address);
						if (data.id > 0)
						{
							$('.beeAddressList').autocomplete( "option", "disabled", true );
							$('.beeAddressList').autocomplete( 'disable' );
							$('.beeAddressList').prop('disabled', true);
						}
					}
				});
			}
		});
		
		$('.beeAddressSave').click(function() {
			$.ajax({
				url: '{{ path('address_edit') }}',	
				data: {
					'id': $('.beeAddressValue').val(),
                    '_token': '{{ form._token.vars.value }}',
					'propertyName': $('.beePropertyName').val(),
					'streetName': $('.beeStreetName').val(),
					'streetNumber': $('.beeStreetNumber').val(),
					'buildingType': $('.beeBuildingType').val(),
					'buildingNumber': $('.beeBuildingNumber').val(),
					'locality_id': $('.beeLocalityList').val()
				},
				type: 'POST',
				success: function(data) {
					$('.beePropertyName').val(data.propertyName);
					$('.beeStreetName').val(data.streetName);
					$('.beeStreetNumber').val(data.streetNumber),
					$('.beeBuildingType').val(data.buildingType),
					$('.beeBuildingNumber').val(data.buildingNumber),
					$('#addressDisplay').html(data.address);
					$('.beeAddressList').autocomplete( "option", "source", data.addressList );
					$('.beeAddressList').data('ui-autocomplete')._trigger('select', 'autocompleteselect', {item:{label: data.addressListLabel, value: data.id}});
					if (data.addressDisabled == 'true') {
						$('.beeAddressList').autocomplete( "option", "disabled", true );
						$('.beeAddressList').autocomplete( 'disable' );
						$('.beeAddressList').prop('disabled', true);
					} else {
						$('.beeAddressList').autocomplete( "option", "disabled", false );
						$('.beeAddressList').prop('disabled', false);
						$('.beeAddressList').autocomplete( 'enable' );
					}
					$('#addressMessage').show()
					$('#addressMessage').removeClass().addClass('row alert alert-' + data.status);
					$('#addressMessage').html(data.message);
					$('#addressMessage').fadeOut(3000);
				}
			});
		});
		$('.beeAddressClear').click(function() {
			$('.beePropertyName').val('');
			$('.beeStreetName').val('');
			$('.beeStreetNumber').val('');
			$('.beeBuildingType').val('');
			$('.beeBuildingNumber').val('');
			$('.beeLocality').val('');
			$('.beeTerritory').val('');
			$('.beeCountry').val('');
			$('.beePostCode').val('');
			$('.beeLocalityList').val('');
			$('.beeAddressValue').val('');
			$('.beeAddressList').val('');
			$('#addressDisplay').html("<pre> </pre>");
			$('.beeAddressList').autocomplete( "option", "disabled", true );
			$('.beeAddressList').autocomplete( 'disable' );
			$('.beeAddressList').prop('disabled', true);
		});
		$("#addAddressLocality").click(function(e){

		    window.open("{{ path('locality_manage', {'id': 'Add'}) }}","Locality","width=820,height=600");
		})
	</script>
